var SignalsSDK;(()=>{"use strict";var e={};e.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})(),(()=>{let t;var n="object",i=function(){},r="undefined"!=typeof process?process:{},o=(r.env&&r.env.NODE_ENV,"undefined"!=typeof document);function a(e,t){return t.charAt(0)[e]()+t.slice(1)}o&&window.location.hostname,null!=r.versions&&r.versions.node,"undefined"!=typeof Deno&&Deno.core,"object"==typeof self&&self.constructor&&self.constructor.name,o&&"nodejs"===window.name||"undefined"!=typeof navigator&&void 0!==navigator.userAgent&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"));var s=a.bind(null,"toUpperCase"),l=a.bind(null,"toLowerCase");function u(e,t){void 0===t&&(t=!0);var n,i=null===e?s("null"):"object"==typeof e?d((n=e).constructor)?n.constructor.name:null:Object.prototype.toString.call(e).slice(8,-1);return t?l(i):i}function c(e,t){return typeof t===e}var d=c.bind(null,"function"),f=c.bind(null,"string"),h=c.bind(null,"undefined");function p(e,t){if("object"!=typeof t||null===t)return!1;if(t instanceof e)return!0;var n,i,r=u(new e(""));if((n=t)instanceof Error||f(n.message)&&n.constructor&&"number"===u(i=n.constructor.stackTraceLimit)&&!isNaN(i))for(;t;){if(u(t)===r)return!0;t=Object.getPrototypeOf(t)}return!1}function v(e,t){var n,i,r=e instanceof Element||e instanceof HTMLDocument;return r&&t?(n=e,void 0===(i=t)&&(i=""),n&&n.nodeName===i.toUpperCase()):r}function m(e){var t=[].slice.call(arguments,1);return function(){return e.apply(void 0,[].slice.call(arguments).concat(t))}}c.bind(null,"boolean"),c.bind(null,"symbol"),p.bind(null,TypeError),p.bind(null,SyntaxError),m(v,"form"),m(v,"button"),m(v,"input"),m(v,"select");var g="__global__",w=typeof self===n&&self.self===self&&self||typeof e.g===n&&e.g.global===e.g&&e.g||void 0;w[g]||(w[g]={});var y=function(){if(void 0!==y)return y;var e="cookiecookie";try{b(e,e),y=-1!==document.cookie.indexOf(e),y?b(e,"",-1):delete w[g][e]}catch(e){y=!1}return y}();function b(e,t,n,i,r,o){if("undefined"!=typeof window){var a=arguments.length>1;return!1===y&&(a?w[g][e]=t:w[g][e]),a?document.cookie=e+"="+encodeURIComponent(t)+(n?"; expires="+new Date(+new Date+1e3*n).toUTCString()+(i?"; path="+i:"")+(r?"; domain="+r:"")+(o?"; secure":""):""):decodeURIComponent((("; "+document.cookie).split("; "+e+"=")[1]||"").split(";")[0])}}var I={"[object HTMLCollection]":!0,"[object NodeList]":!0,"[object RadioNodeList]":!0},E={button:!0,fieldset:!0,reset:!0,submit:!0},S={checkbox:!0,radio:!0},T=/^\s+|\s+$/g,U=Array.prototype.slice,k=Object.prototype.toString,D="Invalid form";function A(e,t){var n=null,i=e.type;if("select-one"===i)return e.options.length&&(n=e.options[e.selectedIndex].value),n;if("select-multiple"===i){n=[];for(var r=0,o=e.options.length;r<o;r++)e.options[r].selected&&n.push(e.options[r].value);return 0===n.length&&(n=null),n}return"file"===i&&"files"in e?e.multiple?0===(n=U.call(e.files)).length&&(n=null):n=e.files[0]:S[i]?e.checked&&(n=e.value):n=t?e.value.replace(T,""):e.value,n}function _(e){return decodeURIComponent(e)}function F(e){return"__proto__"===e||"constructor"===e}var L="true",P="false";function j(e){if(!e)return"";var t=_(e);return"_null"===t?null:"_true"===t?L:"_false"===t?P:t===L||t!==P&&(0*t==0?+t:t)}var O=/.*/,V={"#":"hash","?":"search"},N=/^(https?)?(?:[\:\/]*)([a-z0-9\.-]*)(?:\:(\d+))?(\/[^?#]*)?(?:\?([^#]*))?(?:#(.*))?$/i;function R(e){var t,n;return h(e)&&o?window.location:(void 0===(t=e)&&(t=""),{href:(n=t.match(N))[0]||"",protocol:n[1]||"",hostname:n[2]||"",port:n[3]||"",pathname:n[4]||"",search:n[5]||"",hash:n[6]||""})}function x(e,t,n,i){var r=C(t||i,e);if(!0===n)return r;var o=function(e){void 0===e&&(e="");for(var t,n,i={},r=e.split("&");(t=r.shift())&&!F(n=(t=t.split("=")).shift());)i[n]=void 0!==i[n]?[].concat(i[n],j(t.shift())):j(t.shift());return i}(r);return n?o[n]:o}function C(e,t){var n=R(e)[V[t]];return n.charAt(0)===t?n.substring(1):n}function z(e,t,n){void 0===t&&(t=O);var i=R(n),r=e+C(n,e),a=t instanceof RegExp;if(!a&&-1===r.indexOf(t))return n;var s=RegExp("(\\&|\\"+e+")("+(a?t.source:"\\b"+t+"\\b")+')(=?[_A-Za-z0-9"+=.\\/\\-@%]+)?',"g"),l=r.replace(s,"").replace(/^&/,e),u=i.href.replace(r,l);if(o&&!n&&i.href!==u){var c=window.history;if(!c&&!c.replaceState)return;c.replaceState({},"",u)}return u}function M(e,t){var n,i=Object.create(null);t=function(e){if(!f(e))return!1;var t,n=e.match(N);return n&&(n[2].indexOf(".")>-1||(void 0===(t=n[2])&&(t=""),-1!==t.indexOf("localhost")||-1!==t.indexOf("127.0.0.1")))}(t)||!t?C(t,e):t;for(var r=/([^&=]+)=?([^&]*)/g;n=r.exec(t);){var o=_(n[1]),a=_(n[2]);"[]"===o.substring(o.length-2)?(i[o=o.substring(0,o.length-2)]||(i[o]=[])).push(a):i[o]=""===a||a}for(var s in i){var l=s.split("[");l.length>1&&(function(e,t,n){for(var i=t.length-1,r=0;r<i;++r){var o=t[r];if(F(o))break;o in e||(e[o]={}),e=e[o]}e[t[i]]=n}(i,l.map(function(e){return e.replace(/[?[\]\\ ]/g,"")}),i[s]),delete i[s])}return i}x.bind(null,"?"),x.bind(null,"?",null),z.bind(null,"?"),x.bind(null,"#"),x.bind(null,"#",null),z.bind(null,"#"),M.bind(null,"?"),M.bind(null,"#");let $={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},H=new Uint8Array(16),q=[];for(let e=0;e<256;++e)q.push((e+256).toString(16).slice(1));let B=function(e,n,i){if($.randomUUID&&!n&&!e)return $.randomUUID();let r=(e=e||{}).random||(e.rng||function(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(H)})();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,n){i=i||0;for(let e=0;e<16;++e)n[i+e]=r[e];return n}return function(e,t=0){return q[e[t+0]]+q[e[t+1]]+q[e[t+2]]+q[e[t+3]]+"-"+q[e[t+4]]+q[e[t+5]]+"-"+q[e[t+6]]+q[e[t+7]]+"-"+q[e[t+8]]+q[e[t+9]]+"-"+q[e[t+10]]+q[e[t+11]]+q[e[t+12]]+q[e[t+13]]+q[e[t+14]]+q[e[t+15]]}(r)};var W={i8:"0.2.12"};function Z(e,t){for(let n of t)for(let t of e.keys())if(t.match(n)){let n=e.get(t);if("string"==typeof n&&""!==n)return n}}function K(e,t,n){for(let i of n)for(let n of e.querySelectorAll("input, textarea"))for(let e of t)if(n.hasAttribute(e)){let t=n.getAttribute(e);if(t?.match(i)){let e=n.value;if("string"==typeof e&&""!==e)return e}}}let J=/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/,Q=e=>"nodeType"in e&&e.nodeType===Node.ELEMENT_NODE;function G(e){let t=(Q(e)&&"ownerDocument"in e?e.ownerDocument:window.document).defaultView;return e instanceof t.HTMLFormElement}class X{instance;constructor(e){this.instance=e;let t=(e,t,n)=>{e.querySelectorAll(t).forEach(n),new MutationObserver(e=>{for(let i of e)for(let e of i.addedNodes)Q(e)&&(e.matches(t)&&n(e),e.querySelectorAll(t).forEach(n))}).observe(e.body,{childList:!0,subtree:!0})},n=e=>{(function(e=document){return new Promise(t=>{"complete"===e.readyState||"interactive"===e.readyState?t():e.addEventListener("DOMContentLoaded",()=>t())})})(e).then(()=>t(e,"form",e=>e.addEventListener("submit",this.onSubmit.bind(this)))).catch(()=>{})};n(document),t(document,"iframe",e=>{let t=e.contentDocument;t&&n(t)})}onSubmit(e){if(null!=e.target&&G(e.target)){var t;let n=Z(new FormData(t=e.target),[/^email$/i,/email/i])??K(t,["autocomplete"],[/^email$/])??K(t,["placeholder"],[/email/i])??function(e,t){for(let n of t)for(let t of e.querySelectorAll("input, textarea")){let e=t.value;if("string"==typeof e&&e.match(n))return e}}(t,[J]),i=function(e){var t;let n=new FormData(e);return Z(n,[/^name$/i])??(""!==(t=[K(e,["autocomplete"],[/^given-name$/])??Z(n,[/first.*name/i,/fname/i,/given.*name/i])??K(e,["placeholder"],[/first.*name/i,/given.*name/i]),K(e,["autocomplete"],[/^family-name$/])??Z(n,[/last.*name/i,/lname/i,/surname/i])??K(e,["placeholder"],[/last.*name/i,/surname/i])].filter(e=>null!=e).join(" "))?t:null)??K(e,["autocomplete"],[/^name$/])??K(e,["placeholder"],[/name/i])}(e.target);this.instance.form({...null!=n?{email:n}:{},...null!=i?{name:i}:{}})}}}var Y="EventListener";function ee(e){return function(t,n,r,a){var s=r||i,l=a||!1;if(!o)return s;var u=et(n),c=et(t,!0);if(!c.length)throw Error("noElements");if(!u.length)throw Error("noEvent");var d=[];return function e(t){t&&(d=[]);for(var n=t?"add"+Y:"remove"+Y,i=0;i<c.length;i++){var r=c[i];d[i]=t?l&&l.once?function(e,t){var n;return function(){return e&&(n=e.apply(t||this,arguments),e=null),n}}(s):s:d[i]||s;for(var o=0;o<u.length;o++)r[n]?r["on"+u[o]]=t?d[i]:null:r[n](u[o],d[i],l)}return e.bind(null,!t)}(e)}}function et(e,t){if(f(e))return t?et(document.querySelectorAll(e)):e.split(e.indexOf(",")>-1?",":" ").map(function(e){return e.trim()});if(NodeList.prototype.isPrototypeOf(e)){for(var n,i=[],r=e.length>>>0;r--;)i[r]=e[r];return i}var o=(n=e)?"array"===u(n)?n:[n]:[];return t?o.map(function(e){return f(e)?et(e,!0):e}).flat():o}var en=ee("Event");function ei(e,t){var n,i;return o&&d(window[e])?(n=window[e],void 0===(i=window)&&(i=null),d(n)?function(){n.apply(i,arguments),t.apply(i,arguments)}:t):window[e]=t}ee(),ei.bind(null,"onerror"),ei.bind(null,"onload");var er="undefined"==typeof window,eo="hidden",ea=["mousemove","mousedown","touchmove","touchstart","touchend","keydown"];function es(e,t){return t?0:Math.round((new Date-e)/1e3)}class el{currentUrl;instance;currentFocusTime;aggregateFocusTime;activityTracker;heartbeatInterval;idleTimeout;constructor(e,{heartbeatInterval:t,idleTimeout:n=15}={}){this.instance=e,this.currentUrl=null,this.currentFocusTime=0,this.aggregateFocusTime=0,this.heartbeatInterval=t,this.idleTimeout=n;let i=history.pushState;history.pushState=(...e)=>{i.apply(history,e),this.onPageChange()};let r=history.replaceState;history.replaceState=(...e)=>{r.apply(history,e),this.onReplaceState()},window.addEventListener("popstate",()=>this.onPageChange()),this.activityTracker=function(e){var t,n,i=e.onIdle,r=e.onWakeUp,o=e.onHeartbeat,a=e.timeout,s=void 0===a?1e4:a,l=e.throttle,u=!1,c=!1,d=new Date,f=function(){return clearTimeout(t)};function h(e){f(),o&&!u&&o(es(d),e),r&&u&&(u=!1,r(es(n),e),d=new Date),t=setTimeout(function(){u=!0,i&&(n=new Date,i(es(d),e))},s)}var p=function(e,t){void 0===t&&(t={});var n=function(e,t){var n=this,i=!1;return function(r){i||(e.call(n,r),i=!0,setTimeout(function(){return i=!1},t))}}(e,t.throttle||1e4),i=[];function r(){return i=[function(e){if(er)return!1;var t=er||eo in document?eo:["webkit","moz","ms","o"].reduce(function(e,t){var n=t+"Hidden";return!e&&n in document?n:e},null),n="".concat(t.replace(/[H|h]idden/,""),"visibilitychange"),i=function(){return e(!!document[t])},r=function(){return document.addEventListener(n,i)};return r(),function(){return document.removeEventListener(n,i),r}}(function(e){e||n({type:"tabVisible"})})].concat(ea.map(function(e){return en(document,e,n)})).concat(en(window,"load",n)).concat(en(window,"scroll",n,{capture:!0,passive:!0})),o}function o(){i.map(function(e){return e()})}return r(),function(){return o(),r}}(h,{throttle:void 0===l?2e3:l});return{disable:function(){c=!0,u=!1,f();var e=p();return function(){return c=!1,d=new Date,h({type:"load"}),e()}},getStatus:function(){return{isIdle:u,isDisabled:c,active:u?0:es(d,c),idle:u?es(n,c):0}}}}({onIdle:e=>{this.onPageFocus(e)},onHeartbeat:null!=this.heartbeatInterval?e=>{this.onPageFocus(e)}:void 0,onWakeUp:()=>{this.aggregateFocusTime+=this.currentFocusTime,this.currentFocusTime=0},timeout:1e3*this.idleTimeout,throttle:null!=this.heartbeatInterval?1e3*this.heartbeatInterval:void 0}),window.addEventListener("beforeunload",()=>{this.onLeavingPageFocus()}),this.onPageChange()}resetActivityTracker(){this.aggregateFocusTime=0,this.currentFocusTime=0,this.activityTracker.disable()()}onPageFocus(e){e>=0&&e<=525?(this.currentFocusTime=e,this.instance.pageFocus(this.aggregateFocusTime+this.currentFocusTime)):(this.instance.pageFocus(this.aggregateFocusTime),this.resetActivityTracker())}onLeavingPageFocus(){if(this.currentUrl){let e=this.activityTracker.getStatus();e.isIdle||this.onPageFocus(e.active)}}onPageChange(){this.onLeavingPageFocus(),this.currentUrl=new URL(window.location.href),this.instance.page(),this.resetActivityTracker()}onReplaceState(){let e=new URL(window.location.href);(null==this.currentUrl||this.currentUrl.hostname!==e.hostname||this.currentUrl.pathname!==e.pathname||this.currentUrl.search!==e.search)&&this.onPageChange()}}let eu={USER_ID:"signals-sdk-user-id",SESSION_ID:"signals-sdk-session-id"},ec={EMAIL:"cr_email",EMAIL_BASE64:"cr_e",UTM_ID:"utm_id"};function ed(e){let t=document.createElement("input");if(t.type="email",t.required=!0,t.value=e,!("function"==typeof t.checkValidity?t.checkValidity():/\S+@\S+\.\S+/.test(e)))return!1;let n=e.split("@")[0];return!(null==n||/\*{3,}$/.test(n))}function ef(e,t,n=["string"]){return Object.fromEntries(Object.entries(e).filter(([e,i])=>t.includes(e)&&n.includes(typeof i)))}class eh{siteId;userId;sessionId;apiHost;pageTracker=null;formTracker=null;static version=W.i8;lastPageViewEvent=null;constructor(e,{apiHost:t="https://api.cr-relay.com",autoTracking:n=!0}={}){this.siteId=e,this.apiHost=t,this.userId=this.initializeUserId(),this.sessionId=this.initializeSessionId();try{this.identifyWithQueryParams()}catch(e){console.error("Failed to identify the visitor with query params")}n&&(this.pageTracker=new el(this),this.formTracker=new X(this))}initializeStoredId(e,t,n){let i=b(e),r=""!==i?i:t;return b(e,r,n,"/","."+R(window.location.href).hostname.split(".").slice(-2).join("."),!1),r}initializeSessionId(){return this.initializeStoredId(eu.SESSION_ID,B(),1800)}initializeUserId(){return this.initializeStoredId(eu.USER_ID,B(),31536e3)}identifyWithQueryParams(){let e,t=new URLSearchParams(window.location.search),n=t.get(ec.EMAIL),i=t.get(ec.EMAIL_BASE64),r=t.get(ec.UTM_ID),o=t=>{try{let n=atob(t);ed(n)&&(e=n)}catch(e){}};null!=n&&ed(n)?e=n:null!=i?o(i):null!=r&&o(r),null!=e&&this.identify({email:e})}traceApiUrl(e){return new URL(`v1/site/${e}/batch`,this.apiHost)}async sendEvent(e){let t=this.traceApiUrl(this.siteId).toString(),n=JSON.stringify([e]);try{if(navigator.sendBeacon&&"function"==typeof navigator.sendBeacon&&navigator.sendBeacon(t,n))return;await fetch(t,{method:"POST",body:n,keepalive:!0,headers:{"Content-Type":"application/json"}})}catch(e){console.warn("Failed to send web visit event:",e)}}page(e){let t={eventType:"page_view",url:"string"==typeof e?e:e?.url??window.location.href,userId:this.userId,sessionId:this.sessionId,sdkVersion:eh.version,pageViewId:B()};this.lastPageViewEvent=t,this.sendEvent(t)}pageFocus(e){if(null==this.lastPageViewEvent)return;let t={eventType:"page_focus",pageViewId:this.lastPageViewEvent.pageViewId,focusTime:e,url:this.lastPageViewEvent.url,userId:this.userId,sessionId:this.sessionId,sdkVersion:eh.version};this.sendEvent(t)}identify(e){let t={eventType:"identity",userId:this.userId,sessionId:this.sessionId,sdkVersion:eh.version,...ef(e,["email","name"])};this.sendEvent(t)}identifyWithVector(){void 0!==window.vector&&window.vector.identify(JSON.stringify({userId:this.userId}))}form(e){let t=G(e)?function(e,t){if(void 0===t&&(t={trim:!1}),!e||!e.elements)throw Error(D);for(var n,i={},r=[],o={},a=0,s=e.elements.length;a<s;a++){var l=e.elements[a];E[l.type]||l.disabled||(n=l.name||l.id)&&!o[n]&&(r.push(n),o[n]=!0)}for(var u=0,c=r.length;u<c;u++){var d=function(e,t,n){if(void 0===n&&(n={trim:!1}),!e)throw Error(D);if(!t&&"[object String]"!==k.call(t))throw Error("Field name is required by getInputData");var i=e.elements[t];if(!i||i.disabled)return null;if(!I[k.call(i)])return A(i,n.trim);for(var r=[],o=!0,a=0,s=i.length;a<s;a++)if(!i[a].disabled){o&&"radio"!==i[a].type&&(o=!1);var l=A(i[a],n.trim);null!=l&&(r=r.concat(l))}return o&&1===r.length?r[0]:r.length>0?r:null}(e,n=r[u],t);null!=d&&(i[n]=d)}return i}(e):e,n={eventType:"form",url:window.location.href,userId:this.userId,sessionId:this.sessionId,sdkVersion:eh.version,...ef(t,["email","name"])};this.sendEvent(n)}}!function(e,t){if("string"!=typeof e||""===e)throw Error("siteId is required");if(void 0!==window.signals&&window.signals instanceof eh)throw Error("SignalsSDK already loaded");null==t&&(t={});let n=new eh(e,t);if(Array.isArray(window.signals))for(let[e,t]of window.signals)try{n[e](...t)}catch(t){console.warn(`Error calling ${e}`,t)}window.signals=n}(null!=window.signals&&"_siteId"in window.signals?window.signals._siteId:function(){let e=document.currentScript?.getAttribute("src");return null!=e?e.split("/").at(-2):""}(),null!=window.signals&&"_opts"in window.signals?window.signals._opts:void 0)})(),SignalsSDK={}})();